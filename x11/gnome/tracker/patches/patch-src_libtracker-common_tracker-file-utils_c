$OpenBSD: patch-src_libtracker-common_tracker-file-utils_c,v 1.3 2012/01/22 15:13:23 ajacoutot Exp $
--- src/libtracker-common/tracker-file-utils.c.orig	Fri Dec 16 17:08:04 2011
+++ src/libtracker-common/tracker-file-utils.c	Tue Jan 10 09:51:39 2012
@@ -50,22 +50,34 @@
 
 static GHashTable *file_locks = NULL;
 
-FILE *
-tracker_file_open (const gchar *path)
+gint
+tracker_file_open_fd (const gchar *path)
 {
-	FILE *file;
-	int fd;
+	gint fd;
 
 	g_return_val_if_fail (path != NULL, NULL);
 
 #if defined(__linux__)
-	fd = g_open (path, O_RDONLY | O_NOATIME);
+	fd = g_open (path, O_RDONLY | O_NOATIME, 0);
 	if (fd == -1 && errno == EPERM) {
-		fd = g_open (path, O_RDONLY);
+		fd = g_open (path, O_RDONLY, 0);
 	}
 #else
-	fd = g_open (path, O_RDONLY);
+	fd = g_open (path, O_RDONLY, 0);
 #endif
+
+	return fd;
+}
+
+FILE *
+tracker_file_open (const gchar *path)
+{
+	FILE *file;
+	gint fd;
+
+	g_return_val_if_fail (path != NULL, NULL);
+
+	fd = tracker_file_open_fd (path);
 
 	if (fd == -1) {
 		return NULL;
