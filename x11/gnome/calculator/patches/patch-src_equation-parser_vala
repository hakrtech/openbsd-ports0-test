$OpenBSD: patch-src_equation-parser_vala,v 1.1.1.1 2013/03/29 15:08:03 jasper Exp $

commit 6f7526822afc9eb73a4544c8141961b66085e4c6
Author: PioneerAxon <arth.svnit@gmail.com>
Date:   Tue Mar 26 18:26:09 2013 +0530

    Fix error reporting bug for malformed expression

--- src/equation-parser.vala.orig	Tue Jan 15 09:56:45 2013
+++ src/equation-parser.vala	Fri Mar 29 16:04:32 2013
@@ -777,7 +777,7 @@ public class Parser
             if (token.type != LexerTokenType.PL_EOS)
             {
                 /* Full string is not parsed. */
-                if (error == 0)
+                if (error == ErrorCode.NONE)
                     set_error (ErrorCode.INVALID, token.text, token.start_index, token.end_index);
 
                 error_code = error;
@@ -790,7 +790,7 @@ public class Parser
         if (token.type != LexerTokenType.PL_EOS)
         {
             /* Full string is not parsed. */
-            if (error == 0)
+            if (error == ErrorCode.NONE)
                 set_error (ErrorCode.INVALID, token.text, token.start_index, token.end_index);
 
             error_code = error;
@@ -803,6 +803,9 @@ public class Parser
         /* Input can't be parsed with grammar. */
         if (!ret)
         {
+            if (error == ErrorCode.NONE)
+                set_error (ErrorCode.INVALID);
+
             error_code = error;
             error_token = this.error_token;
             error_start = error_token_start;
