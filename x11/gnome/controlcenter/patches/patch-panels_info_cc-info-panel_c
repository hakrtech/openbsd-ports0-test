$OpenBSD: patch-panels_info_cc-info-panel_c,v 1.7 2014/04/08 15:24:00 ajacoutot Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=727819

--- panels/info/cc-info-panel.c.orig	Tue Apr  8 13:37:36 2014
+++ panels/info/cc-info-panel.c	Tue Apr  8 13:37:21 2014
@@ -1567,6 +1567,12 @@ does_gnome_software_exist (void)
   return g_file_test (BINDIR "/gnome-software", G_FILE_TEST_EXISTS);
 }
 
+static gboolean
+does_gpk_update_viewer_exist (void)
+{
+  return g_file_test (BINDIR "/gpk-update-viewer", G_FILE_TEST_EXISTS);
+}
+
 static void
 on_updates_button_clicked (GtkWidget   *widget,
                            CcInfoPanel *self)
@@ -1625,7 +1631,14 @@ cc_info_panel_init (CcInfoPanel *self)
   self->priv->graphics_data = get_graphics_data ();
 
   widget = WID ("updates_button");
-  g_signal_connect (widget, "clicked", G_CALLBACK (on_updates_button_clicked), self);
+  if (does_gnome_software_exist () || does_gpk_update_viewer_exist ())
+    {
+      g_signal_connect (widget, "clicked", G_CALLBACK (on_updates_button_clicked), self);
+    }
+  else
+    {
+      gtk_widget_destroy (widget);
+    }
 
   info_panel_setup_selector (self);
   info_panel_setup_overview (self);
