$OpenBSD: patch-src_terminal-screen_c,v 1.8 2013/04/08 12:11:52 jasper Exp $

From b7df4813c7b85377309f8b9aecd6cae37af3cb0a Mon Sep 17 00:00:00 2001
From: Christian Persch <chpe@gnome.org>
Date: Mon, 08 Apr 2013 12:04:16 +0000
Subject: screen: Portability fix

https://bugzilla.gnome.org/show_bug.cgi?id=697024

--- src/terminal-screen.c.orig	Wed Mar 20 11:09:31 2013
+++ src/terminal-screen.c	Mon Apr  8 14:09:17 2013
@@ -16,7 +16,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-#include <config.h>
+#include "config.h"
 #define _GNU_SOURCE /* for dup3 */
 
 #include "terminal-screen.h"
@@ -188,6 +188,22 @@ static const TerminalRegexPattern url_regex_patterns[]
 static GRegex **url_regexes;
 static TerminalURLFlavour *url_regex_flavors;
 static guint n_url_regexes;
+
+/* See bug #697024 */
+#ifndef __linux__
+
+#undef dup3
+#define dup3 fake_dup3
+
+static int
+fake_dup3 (int fd, int fd2, int flags)
+{
+  if (dup2 (fd, fd2) == -1)
+    return -1;
+
+  return fcntl (fd2, F_SETFD, flags);
+}
+#endif /* !__linux__ */
 
 G_DEFINE_TYPE (TerminalScreen, terminal_screen, VTE_TYPE_TERMINAL)
 
