$OpenBSD: patch-src_terminal-screen_c,v 1.7 2013/04/08 07:57:03 jasper Exp $

From a8c7f7928f0415d9efc79074d52b534bd253360d Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@humppa.nl>
Date: Mon, 8 Apr 2013 09:50:38 +0200
Subject: [PATCH] Only use dup3 on linux as it's a GLIBC extension.

https://bugzilla.gnome.org/show_bug.cgi?id=697024

--- src/terminal-screen.c.orig	Wed Mar 20 11:09:31 2013
+++ src/terminal-screen.c	Mon Apr  8 09:44:32 2013
@@ -1347,7 +1347,13 @@ terminal_screen_child_setup (FDSetupData *data)
       /* Now we know that target_fd can be safely overwritten. */
       errno = 0;
       do {
+#ifdef __linux
         fd = dup3 (fds[idx], target_fd, 0 /* no FD_CLOEXEC */);
+#else
+	fd = fcntl(fds[idx], F_DUPFD, target_fd);
+	if (fd & FD_CLOEXEC)
+	  _exit (127);
+#endif
       } while (fd == -1 && errno == EINTR);
       if (fd != target_fd)
         _exit (127);
