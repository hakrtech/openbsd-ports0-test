$OpenBSD: patch-pkcs11_secret-store_gkm-secret-binary_c,v 1.3 2012/10/14 11:46:55 ajacoutot Exp $

On OpenBSD, time_t is an int.
https://bugzilla.gnome.org/show_bug.cgi?id=652565

From b7648ca3864cf8d952468bae299806b0fcda5442 Mon Sep 17 00:00:00 2001
From: Stef Walter <stefw@gnome.org>
Date: Fri, 12 Oct 2012 15:39:53 +0000
Subject: secret-store: Set the schema name correctly on loaded items

--- pkcs11/secret-store/gkm-secret-binary.c.orig	Wed Sep 19 10:59:27 2012
+++ pkcs11/secret-store/gkm-secret-binary.c	Sun Oct 14 12:31:39 2012
@@ -73,8 +73,8 @@ typedef struct {
 	char *display_name;
 	const guchar *ptr_secret;
 	gsize n_secret;
-	time_t ctime;
-	time_t mtime;
+	long int ctime;
+	long int mtime;
 	GHashTable *attributes;
 	GList *acl;
 } ItemInfo;
@@ -738,15 +738,18 @@ static void
 setup_item_from_info (GkmSecretItem *item, GkmSecretData *data, ItemInfo *info)
 {
 	GkmSecretObject *obj = GKM_SECRET_OBJECT (item);
+	const gchar *schema_name;
 	GkmSecret *secret;
-	const gchar *type;
 
 	gkm_secret_object_set_label (obj, info->display_name);
 	gkm_secret_object_set_created (obj, info->ctime);
 	gkm_secret_object_set_modified (obj, info->mtime);
 
-	type = gkm_secret_compat_format_item_type (info->type);
-	gkm_secret_item_set_schema (item, type);
+	schema_name = g_hash_table_lookup (info->attributes, GKM_SECRET_FIELD_SCHEMA);
+	if (schema_name == NULL)
+		schema_name = gkm_secret_compat_format_item_type (info->type);
+	gkm_secret_item_set_schema (item, schema_name);
+
 	gkm_secret_item_set_fields (item, info->attributes);
 
 	/* Collection is locked */
@@ -851,7 +854,7 @@ gkm_secret_binary_read (GkmSecretCollection *collectio
 	guchar major, minor, crypto, hash;
 	guint32 flags;
 	guint32 lock_timeout;
-	time_t mtime, ctime;
+	long int mtime, ctime;
 	char *display_name;
 	guint32 tmp;
 	guint32 num_items;
