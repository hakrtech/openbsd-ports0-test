$OpenBSD: patch-daemon_gdm-xdmcp-display-factory_c,v 1.5 2014/03/09 21:56:20 ajacoutot Exp $

From 2d025255ab783208af98d848cca7b5e1bb4e44ef Mon Sep 17 00:00:00 2001
From: Ting-Wei Lan <lantw44@gmail.com>
Date: Mon, 20 Jan 2014 10:15:35 +0000
Subject: Fix build problem on FreeBSD

From 262e075827c4b9a7fad866bde43953b5760360b1 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@gnome.org>
Date: Mon, 03 Mar 2014 08:16:52 +0000
Subject: xdmcp: unbreak build on OpenBSD

--- daemon/gdm-xdmcp-display-factory.c.orig	Tue Sep 17 23:33:48 2013
+++ daemon/gdm-xdmcp-display-factory.c	Mon Mar  3 09:12:17 2014
@@ -35,6 +35,7 @@
 #include <netdb.h>
 #include <arpa/inet.h>
 #include <net/if.h>
+#include <netinet/in.h>
 #ifdef HAVE_SYS_SOCKIO_H
 #include <sys/sockio.h>
 #endif
@@ -376,12 +377,16 @@ ai_flags_str (struct addrinfo *ai)
                 if (ai->ai_flags & AI_NUMERICSERV) {
                         g_string_append (str, "numserv ");
                 }
+#ifdef AI_V4MAPPEP
                 if (ai->ai_flags & AI_V4MAPPED) {
                         g_string_append (str, "v4mapped ");
                 }
+#endif
+#ifdef AI_ALL
                 if (ai->ai_flags & AI_ALL) {
                         g_string_append (str, "all ");
                 }
+#endif
         }
         return g_string_free (str, FALSE);
 }
@@ -1527,7 +1532,9 @@ create_address_from_request (ARRAY8      *req_addr,
         memset (&hints, 0, sizeof (hints));
         hints.ai_family = family;
         /* this should convert IPv4 address to IPv6 if needed */
+#ifdef AI_V4MAPPED
         hints.ai_flags = AI_V4MAPPED;
+#endif
         hints.ai_socktype = SOCK_DGRAM;
 
         if ((gaierr = getaddrinfo (host, serv, &hints, &ai_list)) != 0) {
@@ -2010,7 +2017,9 @@ on_hostname_selected (GdmXdmcpChooserDisplay *display,
         memset (&hints, 0, sizeof (hints));
         hints.ai_family = gdm_address_get_family_type (address);
         /* this should convert IPv4 address to IPv6 if needed */
+#ifdef AI_V4MAPPED
         hints.ai_flags = AI_V4MAPPED;
+#endif
 
         xdmcp_port = g_strdup_printf ("%d", XDM_UDP_PORT);
         if ((gaierr = getaddrinfo (hostname, xdmcp_port, &hints, &ai_list)) != 0) {
