$OpenBSD: patch-server_libvncserver_rfbserver_c,v 1.2 2013/09/12 12:47:32 ajacoutot Exp $

From 51435d3f946d6d2b99b876b7919b9d41022fc408 Mon Sep 17 00:00:00 2001
From: David King <dking@redhat.com>
Date: Wed, 11 Sep 2013 15:08:47 +0000
Subject: Reject new clients if in the deferred state

--- server/libvncserver/rfbserver.c.orig	Mon Dec 17 23:19:00 2012
+++ server/libvncserver/rfbserver.c	Thu Sep 12 14:35:24 2013
@@ -387,7 +387,8 @@ rfbProcessClientMessage(rfbClientPtr cl)
         rfbAuthProcessClientMessage(cl);
         return;
     case RFB_AUTH_DEFERRED:
-	rfbLog("Authentication deferred - ignoring client message\n");
+	rfbLog("Authentication deferred for this client - closing connection\n");
+	rfbCloseClient(cl);
 	return;
     case RFB_INITIALISATION:
         rfbProcessClientInitMessage(cl);
