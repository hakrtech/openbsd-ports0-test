$OpenBSD: patch-src_gui_c,v 1.23 2012/04/06 07:01:38 dcoppa Exp $

Remove deprecated slide_away code to unbreak with glib-2.32

--- src/gui.c.orig	Fri Apr  6 08:48:48 2012
+++ src/gui.c	Fri Apr  6 08:50:42 2012
@@ -2453,51 +2453,6 @@ void vol_button_value_changed_callback(GtkScaleButton 
 }
 #endif
 
-gboolean slide_panel_away(gpointer data)
-{
-    if (!showcontrols)
-        return FALSE;
-
-    if (fs_controls == NULL) {
-        return FALSE;
-    }
-
-    if (!(fullscreen || always_hide_after_timeout)) {
-        //gtk_widget_set_size_request(fs_controls, -1, -1);
-        return FALSE;
-    }
-
-    if (g_mutex_trylock(slide_away)) {
-        // mutex is locked now, unlock it and exit function
-        g_mutex_unlock(slide_away);
-        return FALSE;
-    }
-    // mutex was already locked, this is good since we only want to do the animation if locked
-
-    if (GTK_IS_WIDGET(fs_controls) && gmtk_get_visible(fs_controls) && mouse_over_controls == FALSE) {
-        gtk_widget_hide(fs_controls);
-        g_mutex_unlock(slide_away);
-        return FALSE;
-        /*
-           if (fs_controls->allocation.height <= 1) {
-           gtk_widget_hide(fs_controls);
-           g_mutex_unlock(slide_away);
-           return FALSE;
-           } else {
-           //if (disable_animation) {
-           gtk_widget_set_size_request(fs_controls, fs_controls->allocation.width, 0);
-           //} else {
-           //    gtk_widget_set_size_request(fs_controls, fs_controls->allocation.width,
-           //                                fs_controls->allocation.height - 1);
-           //}
-           return TRUE;
-           }
-         */
-    }
-    g_mutex_unlock(slide_away);
-    return FALSE;
-}
-
 gboolean make_panel_and_mouse_invisible(gpointer data)
 {
     GTimeVal currenttime;
@@ -2515,10 +2470,6 @@ gboolean make_panel_and_mouse_invisible(gpointer data)
         g_get_current_time(&currenttime);
         g_time_val_add(&currenttime, -auto_hide_timeout * G_USEC_PER_SEC);
         if (last_movement_time > 0 && currenttime.tv_sec > last_movement_time) {
-            //if (g_mutex_trylock(slide_away)) {
-            //    g_timeout_add(40, slide_panel_away, NULL);
-            //}
-            // gtk_widget_hide(controls_box);
             hide_fs_controls();
         }
 
@@ -2569,7 +2520,6 @@ gboolean make_panel_and_mouse_invisible(gpointer data)
 gboolean make_panel_and_mouse_visible(gpointer data)
 {
 
-    g_mutex_unlock(slide_away);
     if (showcontrols && GTK_IS_WIDGET(controls_box)) {
         //gtk_widget_set_size_request(controls_box, -1, -1);
         //gtk_widget_show(controls_box);
