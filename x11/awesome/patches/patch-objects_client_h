$OpenBSD: patch-objects_client_h,v 1.2 2013/10/07 14:28:52 dcoppa Exp $

Revert to the old xcb-util-0.3.6 API

commit e858163a0fc7226a7299af65083a6fea0824fa9a
Author: David Mohr <david@mcbf.net>
Date:   Sat Mar 16 15:25:54 2013 -0600

Revert "client: add a limit to the loop (FS#573)"

This reverts commit b8de5f2d43e1c560d3b8cad2eb63b379ae547b9c.

Signed-off-by: Uli Schlachter <psychon@znc.in>

--- objects/client.h.orig	Mon Apr  1 13:44:46 2013
+++ objects/client.h	Mon Oct  7 15:18:11 2013
@@ -99,7 +99,7 @@ struct client_t
     /** Window holding command needed to start it (session management related) */
     xcb_window_t leader_window;
     /** Client's WM_PROTOCOLS property */
-    xcb_icccm_get_wm_protocols_reply_t protocols;
+    xcb_get_wm_protocols_reply_t protocols;
     /** Key bindings */
     key_array_t keys;
     /** Icon */
@@ -188,10 +188,8 @@ client_raise(client_t *c)
     client_t *tc = c;
     int counter = 0;
 
-    /* Find number of transient layers.
-     * We limit the counter to the stack length: if some case, a buggy
-     * application might set transient_for as a loopâ€¦ */
-    for(counter = 0; tc->transient_for && counter <= globalconf.stack.len; counter++)
+    /* Find number of transient layers. */
+    for(counter = 0; tc->transient_for; counter++)
         tc = tc->transient_for;
 
     /* Push them in reverse order. */
@@ -214,8 +212,8 @@ client_raise(client_t *c)
 static inline bool
 client_isfixed(client_t *c)
 {
-    return (c->size_hints.flags & XCB_ICCCM_SIZE_HINT_P_MAX_SIZE
-            && c->size_hints.flags & XCB_ICCCM_SIZE_HINT_P_MIN_SIZE
+    return (c->size_hints.flags & XCB_SIZE_HINT_P_MAX_SIZE
+            && c->size_hints.flags & XCB_SIZE_HINT_P_MIN_SIZE
             && c->size_hints.max_width == c->size_hints.min_width
             && c->size_hints.max_height == c->size_hints.min_height
             && c->size_hints.max_width
