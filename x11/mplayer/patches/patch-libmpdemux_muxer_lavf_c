$OpenBSD: patch-libmpdemux_muxer_lavf_c,v 1.1 2013/01/14 02:20:41 brad Exp $
--- libmpdemux/muxer_lavf.c.orig	Thu May  3 01:38:59 2012
+++ libmpdemux/muxer_lavf.c	Thu May  3 01:51:57 2012
@@ -189,7 +189,7 @@ static void fix_parameters(muxer_stream_t *stream)
 
 	if(stream->type == MUXER_TYPE_AUDIO)
 	{
-		ctx->codec_id = av_codec_get_id(mp_wav_taglists, stream->wf->wFormatTag);
+		ctx->codec_id = mp_tag2codec_id(stream->wf->wFormatTag, 1);
 #if 0 //breaks aac in mov at least
 		ctx->codec_tag = codec_get_wav_tag(ctx->codec_id);
 #endif
@@ -218,7 +218,7 @@ static void fix_parameters(muxer_stream_t *stream)
 	}
 	else if(stream->type == MUXER_TYPE_VIDEO)
 	{
-		ctx->codec_id = av_codec_get_id(mp_bmp_taglists, stream->bih->biCompression);
+		ctx->codec_id = mp_tag2codec_id(stream->bih->biCompression, 0);
                 if(ctx->codec_id <= 0 || force_fourcc)
                     ctx->codec_tag= stream->bih->biCompression;
 		mp_msg(MSGT_MUXER, MSGL_INFO, "VIDEO CODEC ID: %d\n", ctx->codec_id);
@@ -308,7 +308,7 @@ static void write_trailer(muxer_t *muxer)
 static void list_formats(void) {
 	AVOutputFormat *fmt;
 	mp_msg(MSGT_DEMUX, MSGL_INFO, "Available lavf output formats:\n");
-	for (fmt = first_oformat; fmt; fmt = fmt->next)
+	for (fmt = av_oformat_next(NULL); fmt; fmt = av_oformat_next(fmt))
 		mp_msg(MSGT_DEMUX, MSGL_INFO, "%15s : %s\n", fmt->name, fmt->long_name);
 }
 
@@ -364,15 +364,15 @@ int muxer_init_muxer_lavf(muxer_t *muxer)
         priv->oc->preload= (int)(mux_preload*AV_TIME_BASE);
         priv->oc->max_delay= (int)(mux_max_delay*AV_TIME_BASE);
         if (info_name)
-            av_strlcpy(priv->oc->title    , info_name,      sizeof(priv->oc->title    ));
+            av_dict_set(&priv->oc->metadata, "title",     info_name,      0);
         if (info_artist)
-            av_strlcpy(priv->oc->author   , info_artist,    sizeof(priv->oc->author   ));
+            av_dict_set(&priv->oc->metadata, "author",    info_artist,    0);
         if (info_genre)
-            av_strlcpy(priv->oc->genre    , info_genre,     sizeof(priv->oc->genre    ));
+            av_dict_set(&priv->oc->metadata, "genre",     info_genre,     0);
         if (info_copyright)
-            av_strlcpy(priv->oc->copyright, info_copyright, sizeof(priv->oc->copyright));
+            av_dict_set(&priv->oc->metadata, "copyright", info_copyright, 0);
         if (info_comment)
-            av_strlcpy(priv->oc->comment  , info_comment,   sizeof(priv->oc->comment  ));
+            av_dict_set(&priv->oc->metadata, "comment",   info_comment,   0);
 
         if(mux_avopt){
             if(parse_avopts(priv->oc, mux_avopt) < 0){
