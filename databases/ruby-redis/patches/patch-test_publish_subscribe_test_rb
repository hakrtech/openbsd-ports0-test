$OpenBSD: patch-test_publish_subscribe_test_rb,v 1.5 2017/08/28 05:21:22 dcoppa Exp $
Index: test/publish_subscribe_test.rb
--- test/publish_subscribe_test.rb.orig
+++ test/publish_subscribe_test.rb
@@ -233,7 +233,7 @@ class TestPublishSubscribe < Test::Unit::TestCase
   def test_subscribe_past_a_timeout
     # For some reason, a thread here doesn't reproduce the issue.
     sleep = %{sleep #{OPTIONS[:timeout] * 2}}
-    publish = %{ruby -rsocket -e 't=TCPSocket.new("127.0.0.1",#{OPTIONS[:port]});t.write("publish foo bar\\r\\n");t.read(4);t.close'}
+    publish = %{${LOCALBASE}/bin/ruby${GEM_BIN_SUFFIX} -rsocket -e 't=TCPSocket.new("127.0.0.1",#{OPTIONS[:port]});t.write("publish foo bar\\r\\n");t.read(4);t.close'}
     cmd = [sleep, publish].join("; ")
 
     IO.popen(cmd, "r+") do |pipe|
