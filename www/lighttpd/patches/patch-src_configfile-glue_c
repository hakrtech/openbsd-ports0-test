$OpenBSD: patch-src_configfile-glue_c,v 1.1 2012/11/15 10:45:23 brad Exp $

Fix :port handling in $HTTP["host"] checks.

--- src/configfile-glue.c.orig	Wed Nov  7 21:33:53 2012
+++ src/configfile-glue.c	Wed Nov  7 21:33:21 2012
@@ -299,17 +299,13 @@ static cond_result_t config_check_cond_nocache(server 
 				ck_colon = strchr(dc->string->ptr, ':');
 				val_colon = strchr(l->ptr, ':');
 
-				if (ck_colon == val_colon) {
-					/* nothing to do with it */
-					break;
-				}
-				if (ck_colon) {
+				if (NULL != ck_colon && NULL == val_colon) {
 					/* condition "host:port" but client send "host" */
 					buffer_copy_string_buffer(srv->cond_check_buf, l);
 					buffer_append_string_len(srv->cond_check_buf, CONST_STR_LEN(":"));
 					buffer_append_long(srv->cond_check_buf, sock_addr_get_port(&(srv_sock->addr)));
 					l = srv->cond_check_buf;
-				} else if (!ck_colon) {
+				} else if (NULL != val_colon && NULL == ck_colon) {
 					/* condition "host" but client send "host:port" */
 					buffer_copy_string_len(srv->cond_check_buf, l->ptr, val_colon - l->ptr);
 					l = srv->cond_check_buf;
