$OpenBSD: patch-mozilla_ipc_chromium_src_base_dir_reader_bsd_h,v 1.1 2013/08/15 10:42:51 sthen Exp $
--- mozilla/ipc/chromium/src/base/dir_reader_bsd.h.orig	Sat Aug  3 21:05:29 2013
+++ mozilla/ipc/chromium/src/base/dir_reader_bsd.h	Wed Aug 14 15:48:59 2013
@@ -14,6 +14,14 @@
 #include <stdint.h>
 #include <unistd.h>
 
+#ifdef __cplusplus
+extern "C" {
+#endif
+    int getdents(int, void *, unsigned long);
+#ifdef __cplusplus
+}
+#endif
+
 #include "base/logging.h"
 #include "base/eintr_wrapper.h"
 
@@ -59,19 +67,11 @@ class DirReaderBSD {
     if (offset_ != size_)
       return true;
 
-#ifdef OS_OPENBSD
-    const int r = getdirentries(fd_, buf_, sizeof(buf_), basep_);
-#else
     const int r = getdents(fd_, buf_, sizeof(buf_));
-#endif
     if (r == 0)
       return false;
     if (r == -1) {
-#ifdef OS_OPENBSD
-      DLOG(ERROR) << "getdirentries returned an error: " << errno;
-#else
       DLOG(ERROR) << "getdents returned an error: " << errno;
-#endif
       return false;
     }
     size_ = r;
@@ -99,9 +99,6 @@ class DirReaderBSD {
  private:
   const int fd_;
   char buf_[512];
-#ifdef OS_OPENBSD
-  off_t *basep_;
-#endif
   size_t offset_, size_;
 
   DISALLOW_COPY_AND_ASSIGN(DirReaderBSD);
