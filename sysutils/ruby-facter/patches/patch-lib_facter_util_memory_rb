$OpenBSD: patch-lib_facter_util_memory_rb,v 1.2 2014/06/20 22:41:53 jasper Exp $

From 4ee27ee558d280e9ef483af91e1c6270737afb4d Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@humppa.nl>
Date: Thu, 19 Jun 2014 15:19:44 +0200
Subject: [PATCH] (FACT-592) Unbreak swapfree/swapsize facts on OpenBSD

--- lib/facter/util/memory.rb.orig	Fri Jun 20 01:45:38 2014
+++ lib/facter/util/memory.rb	Fri Jun 20 01:45:44 2014
@@ -189,8 +189,8 @@ module Facter::Memory
         0
       end
     when /OpenBSD/i
-      if line =~ /^total: (\d+)k bytes allocated = \d+k used, (\d+)k available$/
-        (is_size) ? $1.to_i : $2.to_i
+      if line =~  /^total: (\d+) (\d+)-blocks allocated, (\d+) used, (\d+) available$/
+        (is_size) ? ($1.to_i * $2.to_i) : ($4.to_i * $2.to_i)
       else
         0
       end
@@ -217,8 +217,10 @@ module Facter::Memory
 
   def self.scale_swap_value(value, kernel)
     case kernel
-    when /OpenBSD/i, /FreeBSD/i
+    when /FreeBSD/i
       value.to_f / 1024.0
+    when /OpenBSD/i
+      value.to_f / 1024.0 / 1024.0
     when /SunOS/i
       value.to_f / 2 / 1024.0
     else
