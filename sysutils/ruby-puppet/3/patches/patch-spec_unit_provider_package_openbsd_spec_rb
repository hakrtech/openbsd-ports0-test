$OpenBSD: patch-spec_unit_provider_package_openbsd_spec_rb,v 1.1 2013/08/06 18:17:36 jasper Exp $

From a5b8b96f703d932b90ce7461b18076bb32ee85b3 Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@humppa.nl>
Date: Tue, 23 Jul 2013 16:55:55 +0200
Subject: Enhance OpenBSD pkg.conf handling

This moves the pkg.conf parsing into it's own method which allows for better
re-use. While here, support for parsing '+=' lines has been added. This allows
for appending to PKG_PATH, instead of merely setting it with '='.

(#21930) Enchance OpenBSD pkg.conf handling

--- spec/unit/provider/package/openbsd_spec.rb.orig	Fri Jul 12 02:15:45 2013
+++ spec/unit/provider/package/openbsd_spec.rb	Mon Jul 29 21:35:35 2013
@@ -184,7 +184,29 @@ describe provider_class do
       provider.install
     end
 
-    %w{ installpath installpath= }.each do |line|
+    it "should append installpath" do
+      urls = ["ftp://your.ftp.mirror/pub/OpenBSD/5.2/packages/amd64/",
+              "http://another.ftp.mirror/pub/OpenBSD/5.2/packages/amd64/"]
+      lines = ["installpath  = #{urls[0]}\n",
+               "installpath += #{urls[1]}\n"]
+
+      expect_read_from_pkgconf(lines)
+      expect_pkgadd_with_env_and_name(urls.join(":")) do
+        provider.install
+      end
+    end
+
+    it "should handle append on first installpath" do
+      url = "ftp://your.ftp.mirror/pub/OpenBSD/5.2/packages/amd64/"
+      lines = ["installpath += #{url}\n"]
+
+      expect_read_from_pkgconf(lines)
+      expect_pkgadd_with_env_and_name(url) do
+        provider.install
+      end
+    end
+
+    %w{ installpath installpath= installpath+=}.each do |line|
       it "should reject '#{line}'" do
         expect_read_from_pkgconf([line])
         expect {
