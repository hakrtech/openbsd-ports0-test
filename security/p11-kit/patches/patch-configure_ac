$OpenBSD: patch-configure_ac,v 1.3 2012/08/22 06:28:53 ajacoutot Exp $

From 359bb15bc83484e4de69fa8dbc9113d97817d01e Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@openbsd.org>
Date: Tue, 21 Aug 2012 09:16:00 +0000
Subject: Use AC_LANG_PROGRAM to detect program_invocation_short_name functionality

--- configure.ac.orig	Mon Jul 16 15:05:03 2012
+++ configure.ac	Wed Aug 22 08:25:23 2012
@@ -71,8 +71,13 @@ if test "$os_unix" = "yes"; then
 
 	# Check if these are declared and/or available to link against
 	AC_CHECK_DECLS([program_invocation_short_name])
-	AC_LINK_IFELSE([AC_LANG_SOURCE([extern char *program_invocation_short_name; void main() { }])],
-		[AC_DEFINE(HAVE_PROGRAM_INVOCATION_SHORT_NAME, [1], [Whether program_invocation_short_name available])])
+	AC_MSG_CHECKING([whether program_invocation_short_name is available])
+	AC_LINK_IFELSE([AC_LANG_PROGRAM([[#include <argp.h>]],
+                                  [[program_invocation_short_name = "test";]])],
+		       [AC_DEFINE([HAVE_PROGRAM_INVOCATION_SHORT_NAME], [1],
+				  [Whether program_invocation_short_name available]),
+			AC_MSG_RESULT([yes])],
+		       [AC_MSG_RESULT([no])])
 	AC_CHECK_DECLS([__progname])
 	AC_LINK_IFELSE([AC_LANG_SOURCE([extern char *__progname; void main() { }])],
 		[AC_DEFINE(HAVE___PROGNAME, [1], [Whether __progname available])])
