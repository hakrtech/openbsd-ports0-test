$OpenBSD: patch-plugins_gtkui_gtkui_c,v 1.1 2014/01/29 20:43:26 dcoppa Exp $

g_thread_init() is deprecated

Properly call gdk_threads_enter() and gdk_threads_leave() to prevent
abort() on startup due to gtk trying to unlock a uninitialized mutex

--- plugins/gtkui/gtkui.c.orig	Sun Nov 17 16:50:31 2013
+++ plugins/gtkui/gtkui.c	Thu Jan 16 09:15:42 2014
@@ -944,9 +944,9 @@ gtkui_thread (void *ctx) {
     XInitThreads (); // gtkglext/xcb doesn't work without this
 #endif
     // let's start some gtk
-    g_thread_init (NULL);
     add_pixmap_directory (deadbeef->get_pixmap_dir ());
     gdk_threads_init ();
+    gdk_threads_enter ();
 
     int argc = 2;
     const char **argv = alloca (sizeof (char *) * argc);
@@ -1117,6 +1117,7 @@ gtkui_thread (void *ctx) {
         gtk_widget_destroy (searchwin);
         searchwin = NULL;
     }
+    gdk_threads_leave ();
 }
 
 gboolean
