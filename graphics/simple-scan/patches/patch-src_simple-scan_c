$OpenBSD: patch-src_simple-scan_c,v 1.7 2013/09/26 08:50:48 ajacoutot Exp $
--- src/simple-scan.c.orig	Thu Sep 26 10:29:05 2013
+++ src/simple-scan.c	Thu Sep 26 10:38:12 2013
@@ -15,7 +15,9 @@
 #include <glib.h>
 #include <glib-object.h>
 #include <gtk/gtk.h>
+#ifndef __OpenBSD__
 #include <gudev/gudev.h>
+#endif
 #include <stdlib.h>
 #include <string.h>
 #include <stdio.h>
@@ -158,7 +160,9 @@ struct _SimpleScanClass {
 struct _SimpleScanPrivate {
 	ScanDevice* default_device;
 	gboolean have_devices;
+#ifndef __OpenBSD__
 	GUdevClient* udev_client;
+#endif
 	UserInterface* ui;
 	Scanner* scanner;
 	Book* book;
@@ -332,8 +336,10 @@ static void simple_scan_scanner_failed_cb (SimpleScan*
 static void _simple_scan_scanner_failed_cb_scanner_scan_failed (Scanner* _sender, gint error_code, const gchar* error_string, gpointer self);
 static void simple_scan_scanner_scanning_changed_cb (SimpleScan* self, Scanner* scanner);
 static void _simple_scan_scanner_scanning_changed_cb_scanner_scanning_changed (Scanner* _sender, gpointer self);
+#ifndef __OpenBSD__
 static void simple_scan_on_uevent (SimpleScan* self, GUdevClient* client, const gchar* action, GUdevDevice* device);
 static void _simple_scan_on_uevent_g_udev_client_uevent (GUdevClient* _sender, const gchar* action, GUdevDevice* device, gpointer self);
+#endif
 void user_interface_set_scan_devices (UserInterface* self, GList* devices);
 void user_interface_set_selected_device (UserInterface* self, const gchar* device);
 static void _scan_device_unref0_ (gpointer var);
@@ -521,11 +527,13 @@ static void _simple_scan_scanner_scanning_changed_cb_s
 }
 
 
+#ifndef __OpenBSD__
 static void _simple_scan_on_uevent_g_udev_client_uevent (GUdevClient* _sender, const gchar* action, GUdevDevice* device, gpointer self) {
 #line 67 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	simple_scan_on_uevent (self, _sender, action, device);
 #line 528 "simple-scan.c"
 }
+#endif
 
 
 static void _scan_device_unref0_ (gpointer var) {
@@ -569,8 +577,10 @@ static void simple_scan_real_startup (GApplication* ba
 	gint _subsystems_size_;
 	gchar** _tmp18_;
 	gint _tmp18__length1;
+#ifndef __OpenBSD__
 	GUdevClient* _tmp19_;
 	GUdevClient* _tmp20_;
+#endif
 	ScanDevice* _tmp21_;
 #line 44 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	self = (SimpleScan*) base;
@@ -662,6 +672,7 @@ static void simple_scan_real_startup (GApplication* ba
 	_tmp18_ = subsystems;
 #line 66 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_tmp18__length1 = subsystems_length1;
+#ifndef __OpenBSD__
 #line 66 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_tmp19_ = g_udev_client_new (_tmp18_);
 #line 66 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
@@ -672,6 +683,7 @@ static void simple_scan_real_startup (GApplication* ba
 	_tmp20_ = self->priv->udev_client;
 #line 67 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	g_signal_connect_object (_tmp20_, "uevent", (GCallback) _simple_scan_on_uevent_g_udev_client_uevent, self, 0);
+#endif
 #line 69 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_tmp21_ = self->priv->default_device;
 #line 69 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
@@ -752,10 +764,12 @@ static void simple_scan_real_shutdown (GApplication* b
 	_user_interface_unref0 (self->priv->ui);
 #line 90 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	self->priv->ui = NULL;
+#ifndef __OpenBSD__
 #line 91 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_g_object_unref0 (self->priv->udev_client);
 #line 91 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	self->priv->udev_client = NULL;
+#endif
 #line 92 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_tmp0_ = self->priv->scanner;
 #line 92 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
@@ -2596,6 +2610,7 @@ static void simple_scan_log_cb (const gchar* log_domai
 }
 
 
+#ifndef __OpenBSD__
 static void simple_scan_on_uevent (SimpleScan* self, GUdevClient* client, const gchar* action, GUdevDevice* device) {
 	Scanner* _tmp0_;
 #line 453 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
@@ -2612,6 +2627,7 @@ static void simple_scan_on_uevent (SimpleScan* self, G
 	scanner_redetect (_tmp0_);
 #line 2613 "simple-scan.c"
 }
+#endif
 
 
 static glong string_strnlen (gchar* str, glong maxlen) {
@@ -3763,8 +3779,10 @@ static void simple_scan_finalize (GObject* obj) {
 	self = G_TYPE_CHECK_INSTANCE_CAST (obj, TYPE_SIMPLE_SCAN, SimpleScan);
 #line 32 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_scan_device_unref0 (self->priv->default_device);
+#ifndef __OpenBSD__
 #line 34 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_g_object_unref0 (self->priv->udev_client);
+#endif
 #line 35 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
 	_user_interface_unref0 (self->priv->ui);
 #line 36 "/home/bob/bzr/simple-scan/trunk/src/simple-scan.vala"
