$OpenBSD: patch-program_js_app_js,v 1.1 2012/11/14 11:42:26 sthen Exp $

http://sourceforge.net/projects/roundcubemail/files/roundcubemail/0.8.3/roundcubemail_0.8.3_compose_reload_fix.diff/download

--- program/js/app.js.orig	Sat Nov 10 14:15:39 2012
+++ program/js/app.js	Wed Nov 14 11:27:40 2012
@@ -207,7 +207,7 @@ a.callbacks.length)for(b=0;b<a.callbacks.length;b++)th
 "purge","expunge","select-all","select-none","sort","expand-all","expand-unread","collapse-all",!1)),this.message_list&&this.triggerEvent("listupdate",{folder:this.env.mailbox,rowcount:this.message_list.rowcount}));break;case "check-recent":case "getunread":case "search":this.env.qsearch=null;case "list":if("mail"==this.task){if(this.enable_command("show","expunge","select-all","select-none","sort",0<this.env.messagecount),this.enable_command("purge",this.purge_mailbox_test()),this.enable_command("expand-all",
 "expand-unread","collapse-all",this.env.threading&&this.env.messagecount),("list"==a.action||"search"==a.action)&&this.message_list)this.msglist_select(this.message_list),this.triggerEvent("listupdate",{folder:this.env.mailbox,rowcount:this.message_list.rowcount})}else if("addressbook"==this.task&&(this.enable_command("export",this.contact_list&&0<this.contact_list.rowcount),"list"==a.action||"search"==a.action))this.enable_command("search-create",""==this.env.source),this.enable_command("search-delete",
 this.env.search_id),this.update_group_commands(),this.triggerEvent("listupdate",{folder:this.env.source,rowcount:this.contact_list.rowcount})}a.unlock&&this.hide_message(a.unlock);this.triggerEvent("responseafter",{response:a});this.triggerEvent("responseafter"+a.action,{response:a})}};this.http_error=function(a,b,d,e,f){d=a.statusText;this.set_busy(!1,null,e);a.abort();this.unload||(a.status&&d?this.display_message(this.get_label("servererror")+" ("+d+")","error"):"timeout"==b?this.display_message(this.get_label("requesttimedout"),
-"error"):0==a.status&&"abort"!=b&&this.display_message(this.get_label("servererror")+" (No connection)","error"),a=a.getResponseHeader("Location"),""!=a&&this.redirect(a),"keep-alive"==f?setTimeout(function(){j.keep_alive();j.start_keepalive()},3E4):"check-recent"==f&&setTimeout(function(){j.check_for_recent(!1);j.start_keepalive()},3E4))};this.async_upload_form=function(a,b,d){var e=(new Date).getTime(),f="rcmupload"+e;if(this.env.upload_progress_name){var g=this.env.upload_progress_name,h=$("input[name="+
+"error"):0==a.status&&"abort"!=b&&this.display_message(this.get_label("servererror")+" (No connection)","error"),"keep-alive"==f?setTimeout(function(){j.keep_alive();j.start_keepalive()},3E4):"check-recent"==f&&setTimeout(function(){j.check_for_recent(!1);j.start_keepalive()},3E4))};this.async_upload_form=function(a,b,d){var e=(new Date).getTime(),f="rcmupload"+e;if(this.env.upload_progress_name){var g=this.env.upload_progress_name,h=$("input[name="+
 g+"]",a);h.length||(h=$("<input>").attr({type:"hidden",name:g}),h.prependTo(a));h.val(e)}document.all?document.body.insertAdjacentHTML("BeforeEnd",'<iframe name="'+f+'" src="program/blank.gif" style="width:0;height:0;visibility:hidden;"></iframe>'):(g=document.createElement("iframe"),g.name=f,g.style.border="none",g.style.width=0,g.style.height=0,g.style.visibility="hidden",document.body.appendChild(g));$(f).bind("load",{ts:e},d);$(a).attr({target:f,action:this.url(b,{_id:this.env.compose_id||"",
 _uploadid:e}),method:"POST"}).attr(a.encoding?"encoding":"enctype","multipart/form-data").submit();return f};this.start_keepalive=function(){this.env.keep_alive&&!this.env.framed&&(this._int&&clearInterval(this._int),"mail"==this.task&&this.gui_objects.mailboxlist?this._int=setInterval(function(){j.check_for_recent(!1)},1E3*this.env.keep_alive):"login"!=this.task&&"print"!=this.env.action&&(this._int=setInterval(function(){j.keep_alive()},1E3*this.env.keep_alive)))};this.keep_alive=function(){this.busy||
 this.http_request("keep-alive")};this.check_for_recent=function(a){if(!this.busy){var b,d="_mbox="+urlencode(this.env.mailbox);a&&(b=this.set_busy(!0,"checkingmail"),d+="&_refresh=1",this.start_keepalive());this.gui_objects.messagelist&&(d+="&_list=1");this.gui_objects.quotadisplay&&(d+="&_quota=1");this.env.search_request&&(d+="&_search="+this.env.search_request);this.http_request("check-recent",d,b)}};this.get_single_uid=function(){return this.env.uid?this.env.uid:this.message_list?this.message_list.get_single_selection():
