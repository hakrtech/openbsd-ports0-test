$OpenBSD: patch-utils_TkCximage_src_CxImage_ximapng_cpp,v 1.2 2012/08/12 17:33:04 jasper Exp $
--- utils/TkCximage/src/CxImage/ximapng.cpp.orig	Tue May 15 22:28:38 2012
+++ utils/TkCximage/src/CxImage/ximapng.cpp	Sat Jul 14 14:59:06 2012
@@ -15,7 +15,7 @@
 void CxImagePNG::ima_png_error(png_struct *png_ptr, char *message)
 {
 	strcpy(info.szLastError,message);
-	longjmp(png_jmpbuf(png_ptr), 1);
+	png_longjmp(png_ptr, 1);
 }
 ////////////////////////////////////////////////////////////////////////////////
 #if CXIMAGE_SUPPORT_DECODE
@@ -80,7 +80,7 @@ bool CxImagePNG::Decode(CxFile *hFile)
 		head.biWidth = png_get_image_width(png_ptr, info_ptr);
 		head.biHeight= png_get_image_height(png_ptr, info_ptr);
 		info.dwType = CXIMAGE_FORMAT_PNG;
-		longjmp(png_jmpbuf(png_ptr), 1);
+		png_longjmp(png_ptr, 1);
 	}
 
 	/* calculate new number of channels */
@@ -101,7 +101,7 @@ bool CxImagePNG::Decode(CxFile *hFile)
 		break;
 	default:
 		strcpy(info.szLastError,"unknown PNG color type");
-		longjmp(png_jmpbuf(png_ptr), 1);
+		png_longjmp(png_ptr, 1);
 	}
 
 	//find the right pixel depth used for cximage
@@ -114,7 +114,7 @@ bool CxImagePNG::Decode(CxFile *hFile)
 	if (!Create(png_get_image_width(png_ptr, info_ptr),
                     png_get_image_height(png_ptr, info_ptr),
                     pixel_depth, CXIMAGE_FORMAT_PNG)){
-		longjmp(png_jmpbuf(png_ptr), 1);
+		png_longjmp(png_ptr, 1);
 	}
 
 	/* get metrics */
@@ -198,7 +198,7 @@ bool CxImagePNG::Decode(CxFile *hFile)
 	}
 
 	// <vho> - handle cancel
-	if (info.nEscape) longjmp(png_jmpbuf(png_ptr), 1);
+	if (info.nEscape) png_longjmp(png_ptr, 1);
 
 	// row_bytes is the width x number of channels x (bit-depth / 8)
 	row_pointers = new BYTE[png_get_rowbytes(png_ptr,info_ptr) + 8];
@@ -221,7 +221,7 @@ bool CxImagePNG::Decode(CxFile *hFile)
 		do	{
 
 			// <vho> - handle cancel
-			if (info.nEscape) longjmp(png_jmpbuf(png_ptr), 1);
+			if (info.nEscape) png_longjmp(png_ptr, 1);
 
 #if CXIMAGE_SUPPORT_ALPHA	// <vho>
 			if (AlphaIsValid()) {
