$OpenBSD: patch-sysdeps_openbsd_open_c,v 1.2 2014/01/23 09:41:25 jasper Exp $

From df1db430320c8646f809ef0224c2a620f7cadd1b Mon Sep 17 00:00:00 2001
From: Robert Nagy <robert@openbsd.org>
Date: Thu, 23 Jan 2014 09:39:39 +0000
Subject: Fix several issues related to process information on OpenBSD and drop lsof usage.

--- sysdeps/openbsd/open.c.orig	Mon Dec  9 15:04:02 2013
+++ sysdeps/openbsd/open.c	Mon Dec  9 15:04:36 2013
@@ -55,6 +55,7 @@ glibtop_open_p (glibtop *server, const char *program_n
 		const unsigned long features,
 		const unsigned flags)
 {
+	char errbuf[_POSIX2_LINE_MAX];
 #ifdef DEBUG
 	fprintf (stderr, "DEBUG (%d): glibtop_open_p ()\n", getpid ());
 #endif
@@ -69,7 +70,7 @@ glibtop_open_p (glibtop *server, const char *program_n
 	server->os_version_code = OpenBSD;
 
 	/* Setup machine-specific data */
-	server->machine.kd = kvm_open (NULL, NULL, NULL, O_RDONLY, "kvm_open");
+	server->machine.kd = kvm_openfiles (NULL, NULL, NULL, O_RDONLY, errbuf);
 
 	if (server->machine.kd == NULL)
 		glibtop_error_io_r (server, "kvm_open");
