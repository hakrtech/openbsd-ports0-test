$OpenBSD: patch-sysdeps_openbsd_proctime_c,v 1.7 2014/01/23 09:41:25 jasper Exp $

From ff07ba102fb6a1bcb058a5e5429181981ce6fa2b Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@humppa.nl>
Date: Thu, 23 Jan 2014 09:34:52 +0000
Subject: Some fields have moved in struct proc from timeval to timespec.

--- sysdeps/openbsd/proctime.c.orig	Sun Jul 24 21:13:56 2011
+++ sysdeps/openbsd/proctime.c	Sat Jun  8 15:00:41 2013
@@ -71,7 +71,7 @@ calcru(struct proc *p, struct timeval *up, struct time
 {
 	quad_t totusec;
 	u_quad_t u, st, ut, it, tot;
-        long sec, usec;
+        long sec, nsec;
         struct timeval tv;
 
 	st = p->p_sticks;
@@ -85,9 +85,9 @@ calcru(struct proc *p, struct timeval *up, struct time
 	}
 
 	sec = p->p_rtime.tv_sec;
-	usec = p->p_rtime.tv_usec;
+	nsec = p->p_rtime.tv_nsec;
 
-	totusec = (quad_t)sec * 1000000 + usec;
+	totusec = (quad_t)sec * 1000000 + nsec/1000;
 
 	if (totusec < 0) {
 		/* XXX no %qd in kernel.  Truncate. */
