$OpenBSD: patch-gio_tests_socket_c,v 1.5 2013/01/08 10:43:58 ajacoutot Exp $

From 475edeb2edad68b4bef818deb7ee7db92598397f Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@gnome.org>
Date: Fri, 19 Oct 2012 12:34:18 +0000
Subject: Allow slightly too big poll duration in /socket/timed_wait test

https://bugzilla.gnome.org/show_bug.cgi?id=686058

--- gio/tests/socket.c.orig	Mon Nov 26 17:52:48 2012
+++ gio/tests/socket.c	Tue Jan  8 11:27:29 2013
@@ -549,6 +548,12 @@ test_ipv6_v4mapped (void)
 
   data = create_server (G_SOCKET_FAMILY_IPV6, v4mapped_server_thread, TRUE);
 
+  if (! g_socket_speaks_ipv4 (data->server))
+    {
+      g_test_message ("Test not run: not supported by the OS");
+      return;
+    }
+
   client = g_socket_new (G_SOCKET_FAMILY_IPV4,
 			 G_SOCKET_TYPE_STREAM,
 			 G_SOCKET_PROTOCOL_DEFAULT,
@@ -617,7 +622,7 @@ test_timed_wait (void)
   poll_duration = g_get_monotonic_time () - start_time;
 
   g_assert_cmpint (poll_duration, >=, 98000);
-  g_assert_cmpint (poll_duration, <, 110000);
+  g_assert_cmpint (poll_duration, <, 112000);
 
   g_socket_close (client, &error);
   g_assert_no_error (error);
